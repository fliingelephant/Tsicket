(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/user"],{"08da":function(o,t,e){"use strict";e.r(t);var n=e("29b2"),a=e.n(n);for(var i in n)"default"!==i&&function(o){e.d(t,o,function(){return n[o]})}(i);t["default"]=a.a},"21db":function(o,t,e){"use strict";(function(o){e("d9cf"),e("921b");n(e("66fd"));var t=n(e("566e"));function n(o){return o&&o.__esModule?o:{default:o}}o(t.default)}).call(this,e("543d")["createPage"])},"29b2":function(o,t,e){"use strict";(function(o){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=getApp(),n={data:function(){return{loadinginfo:!0,userInfo:{},hasUserInfo:!1,hasTsinghuaInfo:!1,tsinghuaid:"xxxxxxxxxx",canIUse:o.canIUse("button.open-type.getUserInfo"),like:0,follow:0,history:0,current:0,tabs:["活动日程"],userActivity:[]}},onLoad:function(){var t=this;e.globalData.userInfo?(this.userInfo=e.globalData.userInfo,console.log(this.userInfo),this.hasUserInfo=!0):this.canIUse?e.userInfoReadyCallback=function(o){t.userInfo=o.userInfo,console.log(t.userInfo),t.hasUserInfo=!0}:o.getUserInfo({success:function(o){e.globalData.userInfo=o.userInfo,t.userInfo=o.userInfo,console.log(t.userInfo),t.hasUserInfo=!0}}),e.globalData.tsinghuaid&&(this.tsinghuaid=e.globalData.tsinghuaid,this.hasTsinghuaInfo=!0),this.loadpage(),o.showShareMenu({})},onShow:function(){var t=this;e.globalData.token&&(console.log("token:"+e.globalData.token),o.request({url:e.globalData.apiurl+"users/tsinghuaid",method:"POST",data:{token:e.globalData.token},header:{"content-type":"application/json",cookie:e.globalData.cookie},success:function(o){console.log("调用绑定"),console.log(o.data),t.hasUserInfo=!0,t.hasTsinghuaInfo=!0,t.tsinghuaid=o.data.tsinghuaid,e.globalData.tsinghuaid=o.data.tsinghuaid,e.globalData.token=void 0},fail:function(o){console.log("绑定失败")}}),e.globalData.token=void 0)},onPullDownRefresh:function(){this.loadpage()},onShareAppMessage:function(o){return{title:e.globalData.sharetitle,path:"/pages/index/index",imageUrl:e.globalData.shareimg}},methods:{loadpage:function(){var t=this;o.request({url:e.globalData.apiurl+"users/view",header:{"content-type":"application/json",cookie:e.globalData.cookie},success:function(o){console.log(o.data),t.follow=o.data.follow,t.history=o.data.history,t.like=o.data.like},fail:function(t){o.showToast({title:"错误",icon:"none"})}}),o.request({url:e.globalData.apiurl+"users/book",header:{"content-type":"application/json",cookie:e.globalData.cookie},success:function(n){console.log("users/book"),console.log(n),n.data.events.forEach(function(o,t){o.isUnfold=!1,o.delay=.1*(t+1)+"s",o.cancel=void 0,o.img_url&&""!=o.img_url||(o.img_url=e.globalData.backimg[parseInt("11"+o.event_id)%4]),setTimeout(function(){o.delay=void 0},100*(t+11))}),t.userActivity=n.data.events,o.stopPullDownRefresh(),o.showToast({title:"加载成功",icon:"none"})},fail:function(t){o.showToast({title:"错误",icon:"none"})}})},cardSwiper:function(o){this.cardCur=o.detail.current},getUserInfo:function(o){console.log(o),e.globalData.userInfo=o.detail.userInfo,this.userInfo=o.detail.userInfo,this.hasUserInfo=!0},tabSelect:function(o){this.current=o.currentTarget.dataset.id},navChange:function(o){this.current=o},swiperChange:function(o){this.current=o.detail.current},likePage:function(){console.log("likepage"),o.navigateTo({url:"../like/like"})},followPage:function(){console.log("followpage"),o.navigateTo({url:"../following/following"})},historyPage:function(){console.log("historypage"),o.navigateTo({url:"../history/history"})},sponsorPage:function(t){o.navigateTo({url:"../sponsor/sponsor?id="+t})},activityPage:function(t){o.navigateTo({url:"../activity/activity?id="+t})},announcementPage:function(o){},QRcodePage:function(o){},cancelActivity:function(t){var n=this;o.showModal({title:"",content:"请确认是否取消参加\r\n"+this.userActivity[t].event_name,success:function(a){a.confirm&&o.request({url:e.globalData.apiurl+"users/book/"+n.userActivity[t].event_id,method:"DELETE",header:{"content-type":"application/json",cookie:e.globalData.cookie},success:function(e){console.log(e),e.data.success?(n.isreserved=!1,n.userActivity[t].delay=void 0,n.userActivity[t].cancel="animation-delete-slide-left",setTimeout(function(){n.userActivity[t].isUnfold=!1,n.userActivity.splice(t,1)},2e3),o.showToast({icon:"none",title:"取消成功"})):o.showToast({icon:"none",title:"操作失败"})},fail:function(o){console.log(o)}})}})},likeActivity:function(t){var n=this;o.request({url:e.globalData.apiurl+"users/like/"+this.userActivity[t].event_id,method:"POST",header:{"content-type":"application/json",cookie:e.globalData.cookie},success:function(o){n.userActivity[t].like=o.data.like,n.like+=o.data.like?1:-1}})},unfold:function(o){this.userActivity[o].isUnfold=!this.userActivity[o].isUnfold},identification:function(){console.log("前往认证"),o.navigateToMiniProgram({appId:"wx1ebe3b2266f4afe0",path:"pages/index/index",envVersion:"trial",extraData:{origin:"miniapp",type:"id.tsinghua"},success:function(o){console.log(o)},fail:function(o){console.log(o)}})}}};t.default=n}).call(this,e("543d")["default"])},"566e":function(o,t,e){"use strict";e.r(t);var n=e("6a83"),a=e("08da");for(var i in a)"default"!==i&&function(o){e.d(t,o,function(){return a[o]})}(i);e("71f9");var s,l=e("f0c5"),u=Object(l["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=u.exports},"6a83":function(o,t,e){"use strict";var n,a=function(){var o=this,t=o.$createElement;o._self._c},i=[];e.d(t,"b",function(){return a}),e.d(t,"c",function(){return i}),e.d(t,"a",function(){return n})},"71f9":function(o,t,e){"use strict";var n=e("e4d8"),a=e.n(n);a.a},e4d8:function(o,t,e){}},[["21db","common/runtime","common/vendor"]]]);